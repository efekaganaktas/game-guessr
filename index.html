<!DOCTYPE html>
<html class="dark" lang="tr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    
    <title>GameGuessr - Steam Yorumlarƒ±ndan Oyun Tahmin Et</title>
    <meta name="description" content="Steam kullanƒ±cƒ± yorumlarƒ±ndan oyunu tahmin et!">
    <meta name="robots" content="index, follow">
    
    <link rel="icon" type="image/png" href="/logo.png">

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#66c0f4",
              "background-light": "#1b2838",
              "background-dark": "#1b2838",
              "container-dark": "#2a475e",
              "steam-dark": "#1b2838",
              "steam-darker": "#111c22",
              "steam-component": "#2a475e",
              "steam-text-light": "#c7d5e0",
              "steam-text-dim": "#91b5ca",
              "steam-accent": "#66c0f4",
              "steam-success": "#a3cf00",
              "steam-error": "#c53232",
              "secondary-accent": "#4a5e70",
              "destructive-accent": "#c53333",
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
          },
        },
      }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        
        .screen-section { display: none; }
        .screen-section.active { display: flex; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: 50;
            justify-content: center; align-items: center;
        }

        .loader {
            border: 4px solid #1b2838; border-top: 4px solid #66c0f4;
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .logo-text {
            background: linear-gradient(to right, #66c0f4, #ffffff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        #suggestion-list {
            position: absolute;
            top: 100%;
            left: 0;
            background: #171a21;
            border: 1px solid #66c0f4;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            border-radius: 0 0 8px 8px;
            display: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            margin-top: 5px;
        }
        #suggestion-list div {
            padding: 12px; cursor: pointer; color: #c7d5e0; border-bottom: 1px solid #2a475e;
        }
        #suggestion-list div:hover {
            background-color: #66c0f4; color: black;
        }
        
        .blur-hint { filter: blur(15px); transition: filter 0.5s; }
        .blur-hint:hover { filter: blur(5px); }
    </style>
</head>
<body class="bg-background-dark text-steam-text-light font-display h-screen overflow-x-hidden">

    <!-- HOME EKRANI -->
    <div id="screen-home" class="screen-section relative h-full w-full flex-col items-center justify-center p-4">
        <div class="absolute inset-0 z-0 h-full w-full bg-[url('https://images.unsplash.com/photo-1612287232817-60f8f6a92f81?fit=max&fm=jpg&q=80&w=1080')] bg-cover bg-center opacity-20 blur-sm"></div>
        
        <div class="relative z-10 flex flex-col items-center gap-8">
            <h1 class="text-6xl font-black tracking-tight drop-shadow-lg logo-text">GameGuessr</h1>
            <div class="bg-container-dark/80 p-8 rounded-2xl shadow-2xl backdrop-blur-sm border border-white/10 w-full max-w-sm flex flex-col items-center gap-6">
                <button onclick="startFlow()" class="w-full h-14 bg-gradient-steam text-[#1b2838] text-xl font-bold rounded-xl shadow-lg hover:scale-105 transition-transform">
                    OYNA
                </button>
                <label class="flex items-center gap-3 cursor-pointer group select-none">
                    <input type="checkbox" id="profanityCheck" class="w-5 h-5 rounded border-gray-500 bg-steam-darker text-primary focus:ring-0">
                    <span class="text-gray-300 group-hover:text-white">K√ºf√ºr Sans√ºr√º (Aile Modu)</span>
                </label>
            </div>
        </div>
    </div>

    <!-- LOGIN EKRANI -->
    <div id="screen-login" class="screen-section relative h-full w-full flex-col items-center justify-center p-4">
        <div class="absolute inset-0 z-0 h-full w-full bg-[#1b2838] opacity-90"></div>
        <div class="relative z-10 flex w-full max-w-md flex-col items-center rounded-lg bg-[#2a475e] p-8 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-4">Kimsin Sen?</h2>
            <input id="usernameInput" class="w-full rounded-lg bg-[#1b2838] p-4 text-[#c7d5e0] text-center" placeholder="Kullanƒ±cƒ± Adƒ±"/>
            <button onclick="loginUser()" class="w-full mt-4 px-6 py-3 rounded-lg bg-primary text-[#1b2838] font-bold hover:bg-white">Devam Et</button>
        </div>
    </div>

    <!-- KATEGORƒ∞ EKRANI -->
    <div id="screen-category" class="screen-section flex-col min-h-screen">
        <header class="flex items-center justify-between border-b border-white/10 px-4 py-3 bg-[#171a21]">
            <h2 class="text-xl font-bold logo-text cursor-pointer" onclick="confirmExit()">GameGuessr</h2>
            <button onclick="logout()" class="rounded-lg h-8 px-3 bg-steam-component text-xs font-bold hover:bg-white hover:text-black">√áƒ±kƒ±≈ü</button>
        </header>
        <main class="flex flex-col flex-1 p-4 sm:px-10">
            <p id="welcomeText" class="text-white text-3xl font-black mb-6">Ho≈ügeldin</p>
            <div id="categoryGrid" class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 pb-10"></div>
        </main>
    </div>

    <div id="screen-loading" class="screen-section flex-col items-center justify-center h-screen">
        <div class="loader mb-4"></div>
        <p class="text-xl font-bold text-primary">Y√ºkleniyor...</p>
    </div>

    <!-- GAME EKRANI -->
    <div id="screen-game" class="screen-section flex-col min-h-screen">
        <header class="relative flex items-center justify-between border-b border-black/20 bg-[#171a21] px-4 py-3">
            <div class="flex items-center gap-2 text-white cursor-pointer" onclick="confirmExit()">
                <span class="material-symbols-outlined text-primary">arrow_back</span>
                <h2 class="font-bold hidden md:block logo-text">GameGuessr</h2>
            </div>
            
            <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
                 <span id="gameCategoryCenter" class="text-primary font-black text-xl uppercase tracking-widest drop-shadow-md">...</span>
            </div>

            <div class="flex gap-4">
                <span id="scoreDisplay" class="text-primary font-medium">Puan: 0</span>
                <span id="gameProgress" class="text-white font-medium">1/10</span>
            </div>
        </header>

        <main class="flex flex-col items-center gap-6 p-4 mt-4 w-full max-w-4xl mx-auto flex-1">
            
            <div id="hintImageArea" class="hidden w-full bg-[#171a21]/90 border border-[#2a475e] rounded-xl overflow-hidden p-4 flex gap-4">
                <div class="w-1/3 min-w-[120px] max-w-[240px] aspect-video relative rounded overflow-hidden bg-black border border-white/10">
                     <img id="hintImage" src="" class="w-full h-full object-cover blur-hint opacity-80 hover:opacity-100 transition-opacity">
                </div>
                <div class="flex-1 flex flex-col justify-center gap-2 text-sm">
                    <h3 class="text-primary font-bold text-lg mb-1">Oyun Detaylarƒ±</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-steam-text-dim">
                        <p>Yapƒ±mcƒ±: <span id="hintDev" class="text-white font-semibold">?</span></p>
                        <p>√áƒ±kƒ±≈ü: <span id="hintDate" class="text-white font-semibold">?</span></p>
                        <p>Beƒüeni: <span id="hintLikes" class="text-white font-semibold">?</span></p>
                    </div>
                </div>
            </div>

            <div class="w-full bg-container-dark p-6 rounded-lg shadow-lg relative border border-white/5 min-h-[180px] flex flex-col justify-center">
                <div id="reviewCountBadge" class="absolute top-4 right-4 bg-black/40 text-primary text-xs font-bold px-3 py-1 rounded-full">...</div>
                <div class="flex flex-col gap-3">
                    <p class="text-primary text-lg font-bold">Oyuncu Yorumu</p>
                    <p id="reviewText" class="text-white text-lg italic leading-relaxed">...</p>
                    <div class="mt-4 border-t border-white/10 pt-2 flex items-center gap-2 text-steam-text-dim text-sm">
                        <span class="material-symbols-outlined text-base">schedule</span>
                        <span id="playtimeText">...</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-2 w-full justify-center">
                <button onclick="useHint('image')" id="btnHintImage" class="px-4 py-2 bg-[#3d2c4d] border border-purple-500/50 text-purple-300 hover:bg-purple-900 text-xs font-bold rounded">üñºÔ∏è G√∂rsel & Bilgi (-15)</button>
                <button onclick="useHint('word')" id="btnHintWord" class="px-4 py-2 bg-[#4d3a2c] border border-orange-500/50 text-orange-300 hover:bg-orange-900 text-xs font-bold rounded">üî§ Harf (-10)</button>
                <button onclick="nextReview()" class="px-4 py-2 bg-secondary-accent hover:bg-[#576b7e] text-white text-xs font-bold rounded">üîÑ Yeni Yorum (-5)</button>
            </div>

            <div class="w-full max-w-lg flex flex-col items-center gap-4 relative">
                <div class="w-full relative">
                    <input id="guessInput" class="w-full rounded-lg bg-black/40 border-none text-white h-14 placeholder:text-slate-400 p-4 text-base focus:ring-2 focus:ring-primary" placeholder="Oyun ismini tahmin et..." autocomplete="off"/>
                    <div id="suggestion-list"></div>
                </div>
                <p id="wordHintText" class="text-center text-primary font-mono tracking-widest text-sm h-5 font-bold"></p>

                <div class="flex w-full gap-3">
                    <button onclick="checkGuess()" class="h-12 px-5 bg-primary hover:bg-white hover:text-black text-slate-900 font-bold rounded-lg grow">Tahmin Et</button>
                    <button onclick="passGame()" class="h-12 px-5 bg-destructive-accent hover:bg-[#d64545] text-white font-bold rounded-lg grow">Pas Ge√ß</button>
                </div>
            </div>

            <p id="feedbackMsg" class="min-h-[1.5rem] text-lg font-bold text-center"></p>
        </main>
    </div>

    <!-- RESULT EKRANI (D√úZENLENDƒ∞) -->
    <div id="screen-result" class="screen-section flex-col min-h-screen pb-10">
        <div class="w-full max-w-[1200px] mx-auto px-4 py-5">
            <h2 class="text-white text-5xl font-black mb-6">Oyun Bitti</h2>
            
            <!-- PUAN B√ñL√úM√ú (G√úNCELLENDƒ∞) -->
            <div class="flex gap-10 items-end mb-10 border-b border-white/10 pb-6">
                <div class="flex flex-col">
                    <span class="text-steam-text-dim text-sm font-bold uppercase tracking-wider mb-1">Mevcut Skor</span>
                    <span id="finalScoreDisplay" class="text-white text-5xl font-black tracking-tight">0</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-steam-text-dim text-sm font-bold uppercase tracking-wider mb-1">En ƒ∞yi Skor</span>
                    <span id="sessionBestDisplay" class="text-primary text-5xl font-black tracking-tight drop-shadow-[0_0_10px_rgba(102,192,244,0.4)]">0</span>
                </div>
            </div>

            <!-- SONU√á G√ñRSELLERƒ∞ (G√úNCELLENDƒ∞: DAHA B√úY√úK + HOVER EFEKTƒ∞) -->
            <div id="resultGrid" class="grid grid-cols-[repeat(auto-fit,minmax(250px,1fr))] gap-6 mb-12"></div>
            
            <h3 class="text-white text-2xl font-bold mb-4">Sƒ±ralama (<span id="resultCategoryTitle">...</span>)</h3>
            <div class="bg-steam-darker rounded-lg border border-[#325467] overflow-hidden mb-8">
                <table class="w-full text-left">
                    <thead class="bg-[#192a34]"><tr><th class="p-4 text-primary">#</th><th class="p-4 text-primary">Kullanƒ±cƒ±</th><th class="p-4 text-primary">Puan</th></tr></thead>
                    <tbody id="leaderboardBody"></tbody>
                </table>
            </div>
            
            <div class="flex justify-center">
                <button onclick="initCategories()" class="px-10 py-4 bg-primary text-black text-lg font-bold rounded-xl hover:bg-white hover:scale-105 transition-all shadow-lg shadow-primary/20">
                    Kategorilere D√∂n
                </button>
            </div>
        </div>
    </div>

    <div id="exitModal" class="modal-overlay">
        <div class="bg-container-dark p-6 rounded-lg shadow-2xl max-w-sm w-full text-center border border-white/10">
            <h3 class="text-xl font-bold text-white mb-2">√áƒ±kmak istiyor musun?</h3>
            <p class="text-steam-text-dim mb-6">ƒ∞lerlemen kaybolacak.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closeExitModal()" class="px-4 py-2 rounded bg-gray-600 text-white">ƒ∞ptal</button>
                <button onclick="doExit()" class="px-4 py-2 rounded bg-destructive-accent text-white font-bold">√áƒ±kƒ±≈ü</button>
            </div>
        </div>
    </div>

    <script>
        // --- AYARLAR ---
        const API_URL = '/api'; 
        let allGameNames = [];

        const CATEGORIES = [
            { name: "Karƒ±≈üƒ±k", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/4000/header.jpg" },
            { name: "Aksiyon", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1091500/header.jpg" },
            { name: "RPG", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/292030/header.jpg" },
            { name: "Strateji", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/289070/header.jpg" },
            { name: "Baƒüƒ±msƒ±z Yapƒ±m", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1145360/header.jpg" },
            { name: "Korku", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/739630/header.jpg" },
            { name: "Macera", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/271590/header.jpg" },
            { name: "Sim√ºlasyon", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/227300/header.jpg" },
            { name: "Hayatta Kalma - Korku", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/252490/header.jpg" },
            { name: "√áok Oyunculu", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/730/header.jpg" },
            { name: "Fizik Tabanlƒ±", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/4000/header.jpg" },
            { name: "E≈üli", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/550/header.jpg" },
            { name: "3D", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1245620/header.jpg" },
            { name: "Birinci ≈ûahƒ±s", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1172470/header.jpg" },
            { name: "Komedi", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/265930/header.jpg" }
        ];

        let state = {
            username: "", score: 0, currentCategoryName: "", highScores: {}, 
            games: [], currentGameIndex: 0, currentReviewIndex: 0, currentPot: 100, 
            history: [], filterProfanity: false
        };

        // --- BA≈ûLANGI√á ---
        window.onload = async function() {
            showScreen('screen-home');
            try { 
                const res = await fetch(`${API_URL}/all-games`); 
                if(res.ok) allGameNames = await res.json(); 
            } catch(e) { console.log("Oyun listesi alƒ±namadƒ±"); }
        };

        // --- EKRAN Y√ñNETƒ∞Mƒ∞ ---
        function showScreen(id) { 
            document.querySelectorAll('.screen-section').forEach(s => s.classList.remove('active')); 
            document.getElementById(id).classList.add('active'); 
        }

        function startFlow() { 
            state.filterProfanity = document.getElementById('profanityCheck').checked; 
            const stored = localStorage.getItem('steam_username'); 
            if(stored) { state.username = stored; initCategories(); } else { showScreen('screen-login'); } 
        }

        function loginUser() { 
            const val = document.getElementById('usernameInput').value.trim(); 
            if(!val) return alert("ƒ∞sim giriniz!"); 
            localStorage.setItem('steam_username', val); 
            state.username = val; initCategories(); 
        }

        function logout() { localStorage.removeItem('steam_username'); showScreen('screen-home'); }
        function confirmExit() { document.getElementById('exitModal').style.display = 'flex'; }
        function closeExitModal() { document.getElementById('exitModal').style.display = 'none'; }
        function doExit() { closeExitModal(); showScreen('screen-home'); }

        function initCategories() {
            document.getElementById('welcomeText').innerText = `Ho≈ügeldin, ${state.username}`;
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = "";
            CATEGORIES.forEach(cat => {
                const div = document.createElement('div');
                div.className = "group relative cursor-pointer overflow-hidden rounded-lg transition-all h-32 hover:ring-2 hover:ring-primary";
                div.onclick = () => fetchGames(cat.name);
                div.innerHTML = `
                    <div class="absolute inset-0 bg-cover bg-center group-hover:scale-110 transition-transform duration-500" style="background-image: url('${cat.img}');"></div>
                    <div class="absolute inset-0 bg-black/60 group-hover:bg-black/40 transition-colors"></div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center p-2">
                        <p class="text-white text-xl font-bold uppercase tracking-wider z-10 drop-shadow-lg">${cat.name}</p>
                    </div>`;
                grid.appendChild(div);
            });
            showScreen('screen-category');
        }

        function cleanText(text) {
            if(!state.filterProfanity) return text;
            const badWords = ["amk", "aq", "mk", "o√ß", "pi√ß", "siktir", "yarak", "yarrak", "amcƒ±k", "ka≈üar", "orosbu", "orospu", "sik"];
            let cleaned = text;
            badWords.forEach(word => { const regex = new RegExp(`\\b${word}\\b`, 'gi'); cleaned = cleaned.replace(regex, "***"); });
            return cleaned;
        }

        // --- OYUN API ---
        async function fetchGames(category) {
            state.currentCategoryName = category; 
            showScreen('screen-loading');
            try { 
                const res = await fetch(`${API_URL}/game-quiz?category=${encodeURIComponent(category)}`); 
                const data = await res.json(); 
                if(!data || data.length === 0) { alert("Bu kategoride oyun bulunamadƒ± veya Steam yanƒ±t vermiyor."); showScreen('screen-category'); return; } 
                state.games = data; 
                state.currentGameIndex = 0; state.score = 0; state.history = []; 
                startGame(); 
            } catch(e) { 
                console.error(e); 
                alert("Sunucu hatasƒ±! L√ºtfen 'node server.js' komutuyla backend'i √ßalƒ±≈ütƒ±rdƒ±ƒüƒ±nƒ±zdan emin olun."); 
                showScreen('screen-category'); 
            }
        }

        function startGame() { showScreen('screen-game'); loadLevel(); }

        function loadLevel() {
            if(state.currentGameIndex >= state.games.length) { endGame(); return; }
            state.currentReviewIndex = 0; 
            state.currentPot = 100;
            
            // UI Sƒ±fƒ±rla
            document.getElementById('hintImageArea').classList.add('hidden');
            document.getElementById('wordHintText').innerText = "";
            document.getElementById('feedbackMsg').innerText = "";
            document.getElementById('btnHintImage').disabled = false;
            document.getElementById('btnHintImage').classList.remove('opacity-50', 'cursor-not-allowed');
            document.getElementById('btnHintWord').disabled = false;
            document.getElementById('btnHintWord').classList.remove('opacity-50', 'cursor-not-allowed');
            
            updateUI();
        }

        function updateUI() {
            const game = state.games[state.currentGameIndex];
            const reviews = game.reviews || [];
            const rev = reviews[state.currentReviewIndex] || {text: "Bu oyun i√ßin g√∂sterilecek ba≈üka yorum kalmadƒ±...", playtime: 0};

            document.getElementById('gameCategoryCenter').innerText = state.currentCategoryName;
            document.getElementById('scoreDisplay').innerText = `Puan: ${state.score}`;
            document.getElementById('gameProgress').innerText = `${state.currentGameIndex + 1}/10`;
            
            let txt = rev.text;
            if(state.filterProfanity) txt = cleanText(txt);
            document.getElementById('reviewText').innerText = `"${txt}"`;
            
            document.getElementById('reviewCountBadge').innerText = `Yorum ${state.currentReviewIndex + 1}/${reviews.length}`;
            document.getElementById('playtimeText').innerHTML = `${rev.playtime} saat oynadƒ±`;
            
            // Input Temizle
            const inp = document.getElementById('guessInput'); 
            inp.value = ""; inp.focus(); 
            document.getElementById('suggestion-list').style.display = 'none';

            // ƒ∞pucu Bilgileri (Gizli DOM elementleri g√ºncelleniyor)
            const d = game.details || {};
            document.getElementById('hintDev').innerText = d.developer || "?";
            document.getElementById('hintDate').innerText = d.date || "?";
            document.getElementById('hintLikes').innerText = d.likes || "?";
            document.getElementById('hintImage').src = game.image;
        }

        // --- ƒ∞PU√áLARI ---
        function useHint(type) {
            const game = state.games[state.currentGameIndex];
            if (type === 'image') {
                state.currentPot = Math.max(0, state.currentPot - 15);
                document.getElementById('hintImageArea').classList.remove('hidden');
                document.getElementById('hintImageArea').classList.add('flex');
                const btn = document.getElementById('btnHintImage');
                btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
            } else if (type === 'word') {
                state.currentPot = Math.max(0, state.currentPot - 10);
                let hiddenName = game.name.replace(/[a-zA-Z0-9]/g, (char, index) => { 
                    return index === 0 || game.name[index-1] === ' ' ? char : '*'; 
                });
                document.getElementById('wordHintText').innerText = hiddenName;
                const btn = document.getElementById('btnHintWord');
                btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function nextReview() {
            const game = state.games[state.currentGameIndex];
            // Eƒüer daha fazla yorum varsa g√∂ster
            if (state.currentReviewIndex < game.reviews.length - 1) {
                state.currentReviewIndex++;
                state.currentPot = Math.max(0, state.currentPot - 5);
                updateUI();
            } else {
                document.getElementById('feedbackMsg').innerText = "Ba≈üka ipucu kalmadƒ±!";
                document.getElementById('feedbackMsg').className = "text-lg font-bold text-center text-steam-error";
            }
        }

        // --- AUTOCOMPLETE & TAHMƒ∞N ---
        const input = document.getElementById('guessInput');
        const list = document.getElementById('suggestion-list');

        input.addEventListener('input', function() {
            const val = this.value.toLowerCase(); 
            list.innerHTML = ''; 
            if (!val) { list.style.display = 'none'; return; }
            
            const matches = allGameNames.filter(n => n.toLowerCase().startsWith(val)).slice(0, 5);
            if (matches.length > 0) { 
                list.style.display = 'block'; 
                matches.forEach(match => { 
                    const div = document.createElement('div'); 
                    div.innerText = match; 
                    div.onclick = function() { 
                        input.value = match; 
                        list.style.display = 'none'; 
                        checkGuess(); 
                    }; 
                    list.appendChild(div); 
                }); 
            } else { list.style.display = 'none'; }
        });

        document.addEventListener('click', (e) => { if(e.target !== input && e.target !== list) list.style.display = 'none'; });
        input.addEventListener('keypress', (e) => { if(e.key === 'Enter') checkGuess(); });

        function checkGuess() {
            const userGuess = input.value.trim().toLowerCase().replace(/[^a-z0-9]/g, "");
            const correctName = state.games[state.currentGameIndex].name.toLowerCase().replace(/[^a-z0-9]/g, "");
            const msg = document.getElementById('feedbackMsg');
            
            if (userGuess === correctName) {
                state.score += state.currentPot;
                state.history.push({...state.games[state.currentGameIndex], isCorrect: true});
                msg.innerText = "DOƒûRU!";
                msg.className = "text-lg font-bold text-center text-steam-success";
                setTimeout(() => { state.currentGameIndex++; loadLevel(); }, 1000);
            } else {
                msg.innerText = "Yanlƒ±≈ü!";
                msg.className = "text-lg font-bold text-center text-steam-error";
            }
        }

        function passGame() {
            state.history.push({...state.games[state.currentGameIndex], isCorrect: false});
            state.currentGameIndex++;
            loadLevel();
        }

        async function endGame() {
            try {
                await fetch(`${API_URL}/submit-score`, { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({username: state.username, category: state.currentCategoryName, score: state.score}) 
                });
                
                const res = await fetch(`${API_URL}/leaderboard?category=${encodeURIComponent(state.currentCategoryName)}`);
                const leaderboard = await res.json();
                
                showScreen('screen-result');
                
                // SKORLARI G√úNCELLE (YENƒ∞ FORMAT)
                document.getElementById('finalScoreDisplay').innerText = `${state.score}`;
                document.getElementById('sessionBestDisplay').innerText = `${state.highScores[state.currentCategoryName] || state.score}`;
                document.getElementById('resultCategoryTitle').innerText = state.currentCategoryName;
                
                // GRID G√úNCELLEME (G√ñRSEL B√úY√úTME + HOVER)
                const grid = document.getElementById('resultGrid'); 
                grid.innerHTML = "";
                state.history.forEach(h => {
                    const div = document.createElement('div');
                    // 'group' sƒ±nƒ±fƒ± eklendi (hover i√ßin), border efekti, ge√ßi≈üler
                    div.className = `group relative aspect-video bg-black rounded-lg border-2 cursor-pointer overflow-hidden transition-transform hover:scale-105 shadow-xl ${h.isCorrect ? 'border-steam-success' : 'border-steam-error'}`;
                    
                    div.innerHTML = `
                        <!-- Resim (Hover olunca hafif kararƒ±r) -->
                        <img src="${h.image}" class="w-full h-full object-cover opacity-80 group-hover:opacity-40 transition-opacity duration-300">
                        
                        <!-- ƒ∞sim (Default gizli, hover olunca g√∂r√ºn√ºr) -->
                        <div class="absolute inset-0 flex items-center justify-center p-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <span class="text-white text-center font-bold text-lg drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] select-none">
                                ${h.name}
                            </span>
                        </div>
                        
                        <!-- Durum ƒ∞konu (K√∂≈üede k√º√ß√ºk belirte√ß) -->
                        <div class="absolute top-2 right-2 bg-black/60 rounded-full p-1 ${h.isCorrect ? 'text-steam-success' : 'text-steam-error'}">
                            <span class="material-symbols-outlined text-sm font-bold">
                                ${h.isCorrect ? 'check' : 'close'}
                            </span>
                        </div>
                    `;
                    grid.appendChild(div);
                });

                const tbody = document.getElementById('leaderboardBody'); 
                tbody.innerHTML = "";
                leaderboard.forEach((p, i) => { 
                    const isMe = p.username === state.username ? "bg-primary text-black font-bold" : "text-slate-400 border-b border-white/5"; 
                    tbody.innerHTML += `<tr class="${isMe}"><td class="p-4">${i+1}</td><td>${p.username}</td><td>${p.score}</td></tr>`; 
                });
            } catch(e) { console.error(e); }
        }
    </script>
</body>
</html>