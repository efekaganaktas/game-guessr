<!DOCTYPE html>
<html class="dark" lang="tr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    
    <!-- TEMEL SEO AYARLARI -->
    <title>GameGuessr - Steam Yorumlarƒ±ndan Oyun Tahmin Etme Oyunu</title>
    <meta name="description" content="GameGuessr ile Steam kullanƒ±cƒ±larƒ±nƒ±n yaptƒ±ƒüƒ± komik, garip ve bilgilendirici yorumlardan hangi oyun olduƒüunu tahmin et! Binlerce oyun ve sonsuz eƒülence seni bekliyor.">
    <meta name="keywords" content="GameGuessr, Game Guessr, Steam oyun tahmin, oyun bulma oyunu, steam yorumlarƒ±, oyun bilgi yarƒ±≈ümasƒ±, gamer test">
    <meta name="robots" content="index, follow">
    <meta name="author" content="GameGuessr">
    <meta name="theme-color" content="#1b2838">
    <link rel="canonical" href="https://gameguessr.com.tr/">
    
    <!-- OPEN GRAPH (Sosyal Medya ve WhatsApp G√∂r√ºn√ºm√º i√ßin) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gameguessr.com.tr/">
    <meta property="og:title" content="GameGuessr - Steam Yorumlarƒ±ndan Oyunu Bul!">
    <meta property="og:description" content="Oyuncularƒ±n ger√ßek yorumlarƒ±ndan oyunu tahmin edebilir misin? Skorunu yap, sƒ±ralamaya gir!">
    <!-- D√ºzeltme: prewiew.jpg -> prewiew.jpeg -->
    <meta property="og:image" content="https://gameguessr.com.tr/prewiew.jpeg">
    <meta property="og:image:alt" content="GameGuessr Logo">

    <!-- TWITTER CARD -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="GameGuessr - Oyun Tahmin Oyunu">
    <meta name="twitter:description" content="Steam yorumlarƒ±ndan oyunu tahmin etme meydan okumasƒ±na katƒ±l.">
    <!-- D√ºzeltme: prewiew.jpg -> prewiew.jpeg -->
    <meta name="twitter:image" content="https://gameguessr.com.tr/prewiew.jpeg">

    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="apple-touch-icon" href="/logo.png">

    <!-- GOOGLE ƒ∞√áƒ∞N YAPISAL VERƒ∞ (Marka ƒ∞smini Tanƒ±tmak ƒ∞√ßin Kritik) -->
    <!-- LOGO ƒ∞√áƒ∞N EKLENEN KISIM -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "GameGuessr",
      "url": "https://gameguessr.com.tr",
      "logo": "https://gameguessr.com.tr/logo.png",
      "sameAs": [
        "https://gameguessr.com.tr"
      ]
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "GameGuessr",
      "alternateName": ["Game Guessr", "SteamGuessr"],
      "url": "https://gameguessr.com.tr/",
      "description": "Steam kullanƒ±cƒ± yorumlarƒ±ndan oyun tahmin etme oyunu.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://gameguessr.com.tr/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "GameGuessr",
      "applicationCategory": "GameApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "TRY"
      }
    }
    </script>

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#66c0f4",
              "background-light": "#1b2838",
              "background-dark": "#1b2838",
              "container-dark": "#2a475e",
              "steam-dark": "#1b2838",
              "steam-darker": "#111c22",
              "steam-component": "#2a475e",
              "steam-text-light": "#c7d5e0",
              "steam-text-dim": "#91b5ca",
              "steam-accent": "#66c0f4",
              "steam-success": "#a3cf00",
              "steam-error": "#c53232",
              "secondary-accent": "#4a5e70",
              "destructive-accent": "#c53333",
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
          },
        },
      }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .bg-gradient-steam { background-image: linear-gradient(to right, #66c0f4, #4a95c2); }
        .bg-gradient-steam:hover { background-image: linear-gradient(to right, #77c9f5, #5aa4d1); }
        
        .screen-section { display: none; }
        .screen-section.active { display: flex; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); z-index: 50;
            justify-content: center; align-items: center; animation: fadeIn 0.2s;
        }

        .loader {
            border: 4px solid #1b2838; border-top: 4px solid #66c0f4;
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .logo-text {
            background: linear-gradient(to right, #66c0f4, #ffffff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* AUTOCOMPLETE D√úZENLENDƒ∞ */
        #suggestion-list {
            position: absolute;
            top: 100%; 
            left: 0;
            background: #171a21;
            border: 1px solid #66c0f4;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            border-radius: 0 0 8px 8px;
            display: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            margin-top: 4px;
        }
        #suggestion-list div {
            padding: 10px; cursor: pointer; color: #c7d5e0; border-bottom: 1px solid #2a475e;
        }
        #suggestion-list div:hover {
            background-color: #66c0f4; color: black;
        }
        
        .blur-hint { 
            filter: blur(5px);
            pointer-events: none;
            user-select: none;
            -webkit-touch-callout: none;
         }

         /* Input border animasyonlarƒ± */
         .shake { animation: shake 0.5s; }
         @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
         }

         /* PAS GE√á TRANSITION OVERLAY */
         #transition-overlay {
            position: fixed;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background-color: #c53333; /* steam-destructive-accent */
            border-radius: 50%;
            z-index: 9999;
            transform: translate(-50%, -50%);
            pointer-events: none; /* Tƒ±klamayƒ± engelleme, ama js ile kontrol edeceƒüiz */
            transition: width 0.5s ease-in-out, height 0.5s ease-in-out, opacity 0.3s;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-background-dark text-steam-text-light font-display h-screen overflow-x-hidden">

    <!-- HOME EKRANI -->
    <div id="screen-home" class="screen-section relative h-full w-full flex-col items-center justify-center p-4">
        <div class="absolute inset-0 z-0 h-full w-full bg-[url('https://images.unsplash.com/photo-1612287232817-60f8f6a92f81?fit=max&fm=jpg&q=80&w=1080')] bg-cover bg-center opacity-20 blur-sm"></div>
        
        <div class="relative z-10 flex flex-col items-center gap-8">
            <div class="flex flex-col items-center gap-2"> <svg class="w-20 h-20 text-primary drop-shadow-[0_0_15px_rgba(102,192,244,0.5)]" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S19.17 9 20 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                </svg>
                <h1 class="text-6xl font-black tracking-tight drop-shadow-lg logo-text">GameGuessr</h1>
            </div>

            <div class="bg-container-dark/80 p-8 rounded-2xl shadow-2xl backdrop-blur-sm border border-white/10 w-full max-w-sm flex flex-col items-center gap-6">
                <button onclick="startFlow()" class="w-full h-14 bg-gradient-steam text-[#1b2838] text-xl font-bold rounded-xl shadow-lg hover:scale-105 transition-transform">
                    OYNA
                </button>

                <label class="flex items-center gap-3 cursor-pointer group select-none">
                    <input type="checkbox" id="profanityCheck" class="w-5 h-5 rounded border-gray-500 bg-steam-darker text-primary focus:ring-0">
                    <span class="text-gray-300 group-hover:text-white transition-colors">K√ºf√ºr Sans√ºr√º (Aile Modu)</span>
                </label>
            </div>
            
            <p class="text-white/40 text-sm mt-10">Oyuncularƒ±n Ger√ßek Yorumlarƒ±ndan Oyunu Tahmin Et</p>
        </div>
    </div>

    <!-- LOGIN EKRANI -->
    <div id="screen-login" class="screen-section relative h-full w-full flex-col items-center justify-center p-4">
        <div class="absolute inset-0 z-0 h-full w-full bg-[url('https://images.unsplash.com/photo-1593305842323-91bb1679415c?fit=max&fm=jpg&q=80&w=1080')] bg-cover bg-center opacity-10 blur-md"></div>
        <div class="relative z-10 flex w-full max-w-md flex-col items-center rounded-lg bg-[#2a475e] p-8 shadow-2xl">
            <h2 class="text-2xl font-bold text-white mb-4">Kimsin Sen?</h2>
            <div class="w-full">
                <input id="usernameInput" maxlength="15" class="form-input flex w-full min-w-0 flex-1 rounded-lg border-2 border-transparent bg-[#1b2838] p-4 text-[#c7d5e0] placeholder:text-[#91b5ca] focus:border-primary focus:outline-none focus:ring-0 text-center" placeholder="Kullanƒ±cƒ± Adƒ±" value=""/>
            </div>
            <div class="flex w-full gap-3 mt-4 justify-center">
                <button onclick="showScreen('screen-home')" class="px-6 py-3 rounded-lg bg-gray-600 text-white font-bold hover:bg-gray-500">Geri</button>
                <button onclick="loginUser()" class="flex-1 px-6 py-3 rounded-lg bg-primary text-[#1b2838] font-bold hover:bg-white transition-colors">
                    Devam Et
                </button>
            </div>
        </div>
    </div>

    <!-- KATEGORƒ∞ EKRANI -->
    <div id="screen-category" class="screen-section flex-col min-h-screen">
        <header class="flex items-center justify-between border-b border-white/10 px-4 sm:px-10 py-3 bg-[#171a21]">
            <div class="flex items-center gap-3 text-white cursor-pointer" onclick="openModal('home')">
                <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S19.17 9 20 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                <h2 class="text-xl font-bold logo-text">GameGuessr</h2>
            </div>
            <button onclick="openModal('logout')" class="rounded-lg h-8 px-3 bg-steam-component text-xs font-bold hover:bg-white hover:text-black transition-colors">√áƒ±kƒ±≈ü Yap</button>
        </header>
        
        <main class="flex flex-col flex-1 p-4 sm:px-10 md:px-20">
            <div class="flex flex-col gap-2 pt-6 pb-6">
                <p id="welcomeText" class="text-white text-3xl font-black">Ho≈ügeldin</p>
                <div class="flex justify-between items-end border-b border-white/10 pb-4">
                    <p class="text-white/60 text-base">Bir kategori se√ß</p>
                </div>
            </div>
            <div id="categoryGrid" class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-4 pb-10">
                </div>
        </main>
    </div>

    <div id="screen-loading" class="screen-section flex-col items-center justify-center h-screen">
        <div class="loader mb-4"></div>
        <p class="text-xl font-bold text-primary">Y√ºkleniyor...</p>
        <p class="text-sm text-steam-text-dim">En iyi yorumlar hazƒ±rlanƒ±yor</p>
    </div>

    <!-- GAME EKRANI -->
    <div id="screen-game" class="screen-section flex-col min-h-screen">
        <header class="relative flex items-center justify-between border-b border-black/20 bg-[#171a21] px-4 py-3">
            <div class="flex items-center gap-2 text-white cursor-pointer group" onclick="openModal('home')" title="Ana Ekrana D√∂n">
                <div class="size-8 text-primary group-hover:rotate-12 transition-transform">
                    <svg fill="currentColor" viewBox="0 0 24 24"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S19.17 9 20 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                </div>
                <h2 class="font-bold hidden md:block logo-text">GameGuessr</h2>
            </div>
            
            <div class="flex gap-4 sm:gap-9">
                <span id="scoreDisplay" class="text-primary font-medium">Puan: 0</span>
                <span id="gameProgress" class="text-white font-medium">1/10</span>
            </div>
        </header>

        <main class="flex flex-col items-center gap-6 p-4 mt-4 w-full max-w-4xl mx-auto flex-1">
            
            <div class="w-full flex justify-center -mt-2">
                 <span id="gameCategoryCenter" class="text-primary font-black text-lg sm:text-2xl uppercase tracking-widest drop-shadow-[0_0_10px_rgba(102,192,244,0.3)]">KATEGORƒ∞</span>
            </div>

            <!-- G√ñRSEL ƒ∞PUCU ALANI -->
            <div id="hintImageArea" class="hidden w-full bg-[#171a21]/90 border border-[#2a475e] rounded-xl overflow-hidden p-4 flex gap-4 transition-all duration-300">
                <div class="w-1/3 min-w-[120px] max-w-[200px] aspect-video relative rounded overflow-hidden border border-white/10 bg-black">
                     <img id="hintImage" src="" class="w-full h-full object-cover blur-hint opacity-80" alt="Oyun ipucu g√∂rseli">
                </div>
                <div class="flex-1 flex flex-col justify-center gap-2 text-sm">
                    <h3 class="text-primary font-bold text-lg mb-1">Oyun Bilgileri</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                        <p class="text-steam-text-dim">Yapƒ±mcƒ±: <span id="hintDev" class="text-white font-semibold">...</span></p>
                        <p class="text-steam-text-dim">√áƒ±kƒ±≈ü Tarihi: <span id="hintDate" class="text-white font-semibold">...</span></p>
                        <p class="text-steam-text-dim">ƒ∞nceleme: <span id="hintLikes" class="text-white font-semibold">...</span></p>
                    </div>
                </div>
            </div>

            <div class="w-full bg-container-dark p-6 rounded-lg shadow-lg relative border border-white/5 min-h-[180px] flex flex-col justify-center">
                <div id="reviewCountBadge" class="absolute top-4 right-4 bg-black/40 text-primary text-xs font-bold px-3 py-1 rounded-full">Yorum 1/10</div>
                <div class="flex flex-col gap-3">
                    <p class="text-primary text-lg font-bold">Oyuncu Yorumu</p>
                    <p id="reviewText" class="text-white text-lg font-normal leading-relaxed italic">"..."</p>
                    
                    <div class="mt-4 border-t border-white/10 pt-2 flex items-center gap-2 text-steam-text-dim text-sm">
                        <span class="material-symbols-outlined text-base">schedule</span>
                        <span id="playtimeText">Oynama S√ºresi: ...</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-2 w-full justify-center">
                <button onclick="useHint('image')" id="btnHintImage" class="px-4 py-2 bg-[#3d2c4d] border border-purple-500/50 text-purple-300 hover:bg-purple-900 text-xs font-bold rounded transition">üñºÔ∏è G√∂rsel & Bilgi (-20)</button>
                <button onclick="useHint('word')" id="btnHintWord" class="px-4 py-2 bg-[#4d3a2c] border border-orange-500/50 text-orange-300 hover:bg-orange-900 text-xs font-bold rounded transition">üî§ Harf (-15)</button>
                <button onclick="nextReview()" class="px-4 py-2 bg-secondary-accent hover:bg-[#576b7e] text-white text-xs font-bold rounded transition">üîÑ Yeni Yorum (-1)</button>
            </div>

            <div class="w-full max-w-lg flex flex-col items-center gap-2 relative">
                
                <!-- 1. ƒ∞PUCU YAZISI (INPUTUN √úST√úNE ALINDI) -->
                <p id="wordHintText" class="text-center text-primary font-mono tracking-widest text-sm h-5 font-bold mb-1"></p>

                <!-- 2. INPUT VE √áARPI BUTONU -->
                <div class="w-full relative group">
                    <!-- pr-12 eklendi ki yazƒ± √ßarpƒ± butonunun altƒ±na girmesin -->
                    <input id="guessInput" class="w-full rounded-lg bg-black/40 border-none text-white h-14 placeholder:text-slate-400 p-4 pr-12 text-base focus:ring-2 focus:ring-primary transition-all duration-200" placeholder="Oyun ismini tahmin et..." autocomplete="off"/>
                    
                    <!-- √áARPI BUTONU (X) -->
                    <button id="clearInputBtn" onclick="clearInput()" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white hidden p-1" title="Temizle">
                        <span class="material-symbols-outlined text-xl">close</span>
                    </button>

                    <div id="suggestion-list"></div>
                </div>
                
                <!-- 3. BUTONLARIN YERƒ∞ DEƒûƒ∞≈ûTƒ∞Rƒ∞LDƒ∞ (SOL: PAS GE√á, SAƒû: TAHMƒ∞N ET) -->
                <div class="flex w-full gap-3 mt-2">
                    <button onclick="passGame(this)" class="h-12 px-5 bg-destructive-accent hover:bg-[#d64545] text-white font-bold rounded-lg grow transition-colors shadow-lg">Pas Ge√ß</button>
                    <button onclick="checkGuess()" class="h-12 px-5 bg-primary hover:bg-white hover:text-black text-slate-900 font-bold rounded-lg grow transition-colors shadow-lg">Tahmin Et</button>
                </div>
            </div>

            <div class="min-h-6 pt-2">
                <!-- Geri bildirim mesajƒ± artƒ±k sadece gerektiƒüinde kullanƒ±lacak, ana geri bildirim border olacak -->
                <p id="feedbackMsg" class="hidden text-lg font-bold text-center"></p>
            </div>
        </main>
    </div>

    <!-- RESULT EKRANI -->
    <div id="screen-result" class="screen-section flex-col min-h-screen pb-10">
        <div class="w-full max-w-[960px] mx-auto px-4 sm:px-10 py-5">
            <div class="flex flex-col gap-2 p-4">
                <p class="text-white text-4xl font-black">Oyun Bitti</p>
                <div class="flex flex-wrap gap-6 items-end border-b border-white/10 pb-4">
                    <p id="finalScoreDisplay" class="text-steam-text-dim text-xl">Mevcut Skor : 0</p>
                    <p id="sessionBestDisplay" class="text-primary text-xl font-bold">En ƒ∞yi Skor : 0</p>
                </div>
            </div>

            <div id="resultGrid" class="grid grid-cols-[repeat(auto-fit,minmax(160px,1fr))] gap-2 p-4"></div>

            <h2 class="text-white text-2xl font-bold px-4 pt-8 pb-4">Sƒ±ralama (<span id="resultCategoryTitle">...</span>)</h2>
            <div class="px-4">
                <div class="overflow-hidden rounded-lg border border-[#325467] bg-steam-darker">
                    <table class="w-full">
                        <thead class="bg-[#192a34]">
                            <tr><th class="px-4 py-3 text-left text-primary">#</th><th class="px-4 py-3 text-left text-primary">Kullanƒ±cƒ±</th><th class="px-4 py-3 text-left text-primary">Puan</th></tr>
                        </thead>
                        <tbody id="leaderboardBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="flex justify-center pt-8">
                <button onclick="initCategories()" class="h-12 px-8 bg-primary text-steam-darker font-bold rounded-lg hover:bg-white transition-colors">Kategorilere D√∂n</button>
            </div>
        </div>
    </div>

    <!-- Dƒ∞NAMƒ∞K MODAL -->
    <div id="exitModal" class="modal-overlay">
        <div class="bg-container-dark p-6 rounded-lg shadow-2xl max-w-sm w-full text-center border border-white/10">
            <h3 id="modalTitle" class="text-xl font-bold text-white mb-2">√áƒ±kmak istiyor musun?</h3>
            <p id="modalText" class="text-steam-text-dim mb-6">Mevcut oyun ilerlemen kaybolacak.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closeModal()" class="px-4 py-2 rounded bg-gray-600 text-white hover:bg-gray-500">Hayƒ±r</button>
                <button id="modalConfirmBtn" class="px-4 py-2 rounded bg-destructive-accent text-white hover:bg-red-600 font-bold">Evet</button>
            </div>
        </div>
    </div>

    <!-- TRANSITION OVERLAY -->
    <div id="transition-overlay"></div>

    <script>
        const API_URL = '/api'; 
        let allGameNames = [];

        // KATEGORƒ∞LER
        const CATEGORIES = [
            { name: "Karƒ±≈üƒ±k", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/4000/header.jpg" },
            { name: "Aksiyon", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1091500/header.jpg" },
            { name: "RPG", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/292030/header.jpg" },
            { name: "Strateji", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/289070/header.jpg" },
            { name: "Baƒüƒ±msƒ±z Yapƒ±m", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1145360/header.jpg" },
            { name: "Korku", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/739630/header.jpg" },
            { name: "Macera", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/271590/header.jpg" },
            { name: "Sim√ºlasyon", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/227300/header.jpg" },
            { name: "Hayatta Kalma - Korku", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/252490/header.jpg" },
            { name: "√áok Oyunculu", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/730/header.jpg" },
            { name: "Fizik Tabanlƒ±", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/4000/header.jpg" },
            { name: "E≈üli", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/550/header.jpg" },
            { name: "3D", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1245620/header.jpg" },
            { name: "Birinci ≈ûahƒ±s", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/1172470/header.jpg" },
            { name: "Komedi", img: "https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/265930/header.jpg" }
        ];

        let state = {
            username: "", score: 0, currentCategoryName: "", highScores: {}, 
            games: [], currentGameIndex: 0, currentReviewIndex: 0, currentPot: 100, 
            history: [], filterProfanity: false, isTransitioning: false
        };

        // --- TARAYICI GE√áMƒ∞≈ûƒ∞ Y√ñNETƒ∞Mƒ∞ (HISTORY API) ---
        
        // Kullanƒ±cƒ± geri tu≈üuna bastƒ±ƒüƒ±nda tetiklenir
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.screen) {
                // Kaydedilen ekranƒ± a√ß, ancak tekrar history'e ekleme yapma ('none')
                showScreen(event.state.screen, 'none');
            } else {
                // Eƒüer state yoksa ana ekrana d√∂n
                showScreen('screen-home', 'none');
            }
        });

        // showScreen g√ºncellendi: historyMode parametresi eklendi
        // historyMode: 'push' (yeni kayƒ±t), 'replace' (mevcutu deƒüi≈ütir), 'none' (kayƒ±t yok)
        function showScreen(id, historyMode = 'push') {
            document.querySelectorAll('.screen-section').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(id);
            if(target) target.classList.add('active');

            if (historyMode === 'push') {
                history.pushState({ screen: id }, "", "");
            } else if (historyMode === 'replace') {
                history.replaceState({ screen: id }, "", "");
            }
        }

        // --- SKOR Y√ñNETƒ∞Mƒ∞ ---
        function getUserDataKey(username) {
            return `gameguessr_data_${username}`;
        }

        function loadUserHighScores(username) {
            const key = getUserDataKey(username);
            const raw = localStorage.getItem(key);
            if (!raw) return {};

            try {
                const data = JSON.parse(raw);
                const FIVE_DAYS_MS = 5 * 24 * 60 * 60 * 1000;
                const now = Date.now();

                if (now - data.lastSeen > FIVE_DAYS_MS) {
                    localStorage.removeItem(key);
                    return {};
                }

                data.lastSeen = now;
                localStorage.setItem(key, JSON.stringify(data));
                return data.scores || {};
            } catch (e) {
                return {};
            }
        }

        function saveUserHighScore(username, category, newScore) {
            const key = getUserDataKey(username);
            let data = { scores: {}, lastSeen: Date.now() };
            
            const raw = localStorage.getItem(key);
            if (raw) {
                try { data = JSON.parse(raw); } catch (e) {}
            }

            const currentBest = data.scores[category] || 0;
            if (newScore > currentBest) {
                data.scores[category] = newScore;
            }
            
            data.lastSeen = Date.now();
            localStorage.setItem(key, JSON.stringify(data));
            
            return data.scores;
        }

        function clearUserData(username) {
            localStorage.removeItem(getUserDataKey(username));
        }

        window.onload = async function() {
            // ƒ∞lk a√ßƒ±lƒ±≈üta mevcut durumu replace et
            history.replaceState({ screen: 'screen-home' }, "", "");
            showScreen('screen-home', 'none');
            
            try { const res = await fetch(`${API_URL}/all-games`); if(res.ok) allGameNames = await res.json(); } catch(e) { console.log("Liste √ßekilemedi"); }
            
            const storedUser = localStorage.getItem('steam_username');
            if (storedUser) {
                state.username = storedUser;
                state.highScores = loadUserHighScores(state.username);
                // Doƒürudan kategoriye gidiyorsak bunu history'e ekleyelim
                initCategories('push');
            }
        };

        
        function startFlow() { 
            state.filterProfanity = document.getElementById('profanityCheck').checked; 
            const stored = localStorage.getItem('steam_username'); 
            if(stored) { 
                state.username = stored; 
                state.highScores = loadUserHighScores(state.username);
                initCategories('push'); 
            } else { 
                showScreen('screen-login', 'push'); 
            } 
        }

        function loginUser() { 
            const val = document.getElementById('usernameInput').value.trim(); 
            if(!val) return alert("L√ºtfen bir isim girin!"); 
            
            localStorage.setItem('steam_username', val); 
            state.username = val; 
            state.highScores = loadUserHighScores(state.username);
            
            // Login sonrasƒ± kategori ekranƒ±na ge√ßi≈ü 'replace' ile yapƒ±lƒ±r ki geri basƒ±nca login'e d√∂nmesin
            initCategories('replace'); 
        }

        async function logout() { 
            if(state.username) {
                try {
                    await fetch(`${API_URL}/logout`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ username: state.username })
                    });
                } catch (e) {
                    console.log("Sunucudan √ßƒ±kƒ±≈ü yapƒ±lamadƒ±, ancak yerel veri siliniyor.");
                }
                clearUserData(state.username);
            }
            localStorage.removeItem('steam_username'); 
            state.username = "";
            state.highScores = {};
            showScreen('screen-home', 'replace'); // √áƒ±kƒ±≈ü yapƒ±nca ge√ßmi≈üi temizlemi≈ü gibi davran
        }
        
        function openModal(type) {
            const modal = document.getElementById('exitModal');
            const title = document.getElementById('modalTitle');
            const text = document.getElementById('modalText');
            const btn = document.getElementById('modalConfirmBtn');

            if (type === 'logout') {
                title.innerText = "√áƒ±kmak istiyor musun?";
                text.innerText = "Mevcut ilerlemen kaybolacak.";
                text.style.display = 'block'; 
                btn.onclick = async () => { await logout(); closeModal(); };
            } else if (type === 'home') {
                title.innerText = "Ana ekrana git?";
                text.innerText = ""; 
                text.style.display = 'none'; 
                btn.onclick = () => { doExit(); closeModal(); };
            }

            modal.style.display = 'flex';
        }

        function closeModal() { document.getElementById('exitModal').style.display = 'none'; }
        
        function doExit() { showScreen('screen-home', 'push'); }

        // initCategories parametre aldƒ±
        function initCategories(historyMode = 'push') {
            document.getElementById('welcomeText').innerText = `Ho≈ügeldin, ${state.username}`;
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = "";
            CATEGORIES.forEach(cat => {
                const div = document.createElement('div');
                div.className = "group relative cursor-pointer overflow-hidden rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-primary/30 hover:ring-2 hover:ring-primary h-32";
                div.onclick = () => fetchGames(cat.name);
                
                const rec = state.highScores[cat.name] || 0;
                
                div.innerHTML = `<div class="absolute inset-0 bg-cover bg-center transition-transform duration-500 group-hover:scale-110" style="background-image: url('${cat.img}');"></div><div class="absolute inset-0 bg-black/60 group-hover:bg-black/40 transition-colors"></div><div class="absolute inset-0 flex flex-col items-center justify-center p-2"><p class="text-white text-xl font-bold uppercase tracking-wider text-center z-10 drop-shadow-lg">${cat.name}</p><p class="text-primary text-sm font-bold mt-1 z-10 drop-shadow-md">Rekor: ${rec}</span></div>`;
                grid.appendChild(div);
            });
            showScreen('screen-category', historyMode);
        }

        function cleanText(text) {
            if(!state.filterProfanity) return text;
            const badWords = ["amk", "aq", "mk", "o√ß", "pi√ß", "siktir", "yarak", "yarrak", "amcƒ±k", "ka≈üar", "orosbu", "orospu", "sik"];
            let cleaned = text;
            badWords.forEach(word => { const regex = new RegExp(`\\b${word}\\b`, 'gi'); cleaned = cleaned.replace(regex, "***"); });
            return cleaned;
        }

        async function fetchGames(category) {
            state.currentCategoryName = category; 
            // Loading ekranƒ± history'e eklenmesin ('none')
            showScreen('screen-loading', 'none');
            
            try { const res = await fetch(`${API_URL}/game-quiz?category=${encodeURIComponent(category)}`); const data = await res.json(); if(!data || data.length === 0) { alert("Oyun bulunamadƒ±."); showScreen('screen-category', 'replace'); return; } state.games = data; state.currentGameIndex = 0; state.score = 0; state.history = []; startGame(); } catch(e) { console.error(e); alert("Sunucuya baƒülanƒ±lamadƒ±."); showScreen('screen-category', 'replace'); }
        }

        function startGame() { 
            // Oyun ekranƒ± history'e eklensin
            showScreen('screen-game', 'push'); 
            loadLevel(); 
        }
        
        function loadLevel() { 
            if(state.currentGameIndex >= state.games.length) { endGame(); return; } 
            state.currentReviewIndex = 0; state.currentPot = 100; 
            
            document.getElementById('hintImageArea').classList.add('hidden'); 
            document.getElementById('wordHintText').innerText = ""; 
            
            document.getElementById('btnHintImage').disabled = false; 
            document.getElementById('btnHintWord').disabled = false; 
            document.getElementById('btnHintImage').classList.remove('opacity-50', 'cursor-not-allowed'); 
            document.getElementById('btnHintWord').classList.remove('opacity-50', 'cursor-not-allowed'); 
            document.getElementById('feedbackMsg').innerText = ""; 
            
            // Inputu sƒ±fƒ±rla ve border renklerini temizle
            const inp = document.getElementById('guessInput');
            inp.value = "";
            inp.className = "w-full rounded-lg bg-black/40 border-none text-white h-14 placeholder:text-slate-400 p-4 pr-12 text-base focus:ring-2 focus:ring-primary transition-all duration-200";
            
            document.getElementById('clearInputBtn').classList.add('hidden');
            
            updateUI(); 
        }
        
        function updateUI() {
            const game = state.games[state.currentGameIndex];
            const rev = game.reviews[state.currentReviewIndex] || {text: "Yorum yok.", playtime: 0};
            
            document.getElementById('gameCategoryCenter').innerText = state.currentCategoryName;
            document.getElementById('scoreDisplay').innerText = `Puan: ${state.score}`;
            document.getElementById('gameProgress').innerText = `${state.currentGameIndex + 1}/10`;
            let txt = rev.text; if(state.filterProfanity) txt = cleanText(txt);
            document.getElementById('reviewText').innerText = `"${txt}"`;
            document.getElementById('reviewCountBadge').innerText = `Yorum ${state.currentReviewIndex + 1}/10`;
            document.getElementById('playtimeText').innerHTML = `${rev.playtime} saat oynadƒ±`;
            
            document.getElementById('suggestion-list').style.display = 'none';

            const details = game.details || { developer: "Bilinmiyor", date: "?", likes: "0" };
            document.getElementById('hintDev').innerText = details.developer;
            document.getElementById('hintDate').innerText = details.date;
            document.getElementById('hintLikes').innerText = details.likes;
            document.getElementById('hintImage').src = game.image;
        }

        function useHint(type) {
            const game = state.games[state.currentGameIndex];
            if (type === 'image') {
                state.currentPot -= 20; if(state.currentPot < 0) state.currentPot = 0;
                document.getElementById('hintImageArea').classList.remove('hidden');
                document.getElementById('hintImageArea').classList.add('flex');
                const btn = document.getElementById('btnHintImage'); btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
            } else if (type === 'word') {
                state.currentPot -= 15; if(state.currentPot < 0) state.currentPot = 0;
                let hiddenName = game.name.replace(/[a-zA-Z0-9]/g, (char, index) => { return index === 0 || game.name[index-1] === ' ' ? char : '*'; });
                document.getElementById('wordHintText').innerText = hiddenName;
                const btn = document.getElementById('btnHintWord'); btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        function nextReview() { 
            if(state.currentReviewIndex < 9) { 
                state.currentReviewIndex++; 
                state.currentPot -= 1; 
                if(state.currentPot < 0) state.currentPot = 0; 
                updateUI(); 
            } else { 
                document.getElementById('feedbackMsg').innerText = "Son ipucu!"; 
            } 
        }

        // --- INPUT & AUTOCOMPLETE & CLEAR BUTTON ---
        const input = document.getElementById('guessInput');
        const list = document.getElementById('suggestion-list');
        const clearBtn = document.getElementById('clearInputBtn');

        // Temizleme fonksiyonu
        function clearInput() {
            input.value = '';
            input.focus();
            list.style.display = 'none';
            toggleClearBtn();
            // Hata veya ba≈üarƒ± durumlarƒ±nƒ± (kƒ±rmƒ±zƒ±/ye≈üil) temizle
            resetInputValidation();
        }

        function toggleClearBtn() {
            if(input.value.length > 0) {
                clearBtn.classList.remove('hidden');
            } else {
                clearBtn.classList.add('hidden');
            }
        }
        
        function resetInputValidation() {
            // Tailwind sƒ±nƒ±flarƒ±nƒ± temizle: ring-steam-error, ring-steam-success vb.
            input.classList.remove('ring-4', 'ring-steam-error', 'ring-steam-success', '!ring-opacity-100');
            // Orijinal focus ring'i geri getir (eƒüer silindiyse)
            input.classList.add('focus:ring-2', 'focus:ring-primary');
        }

        input.addEventListener('input', function() {
            toggleClearBtn();
            resetInputValidation(); // Yazmaya ba≈ülayƒ±nca kƒ±rmƒ±zƒ±lƒ±k gitsin

            const val = this.value.toLowerCase(); 
            list.innerHTML = ''; 
            if (!val) { list.style.display = 'none'; return; }
            
            const matches = allGameNames.filter(n => n.toLowerCase().startsWith(val)).slice(0, 5);
            if (matches.length > 0) { 
                list.style.display = 'block'; 
                matches.forEach(match => { 
                    const div = document.createElement('div'); 
                    div.innerText = match; 
                    div.onclick = function() { 
                        input.value = match; 
                        list.style.display = 'none'; 
                        toggleClearBtn();
                        // checkGuess(); // KALDIRILDI: Artƒ±k otomatik tahmin etmiyor
                    }; 
                    list.appendChild(div); 
                }); 
            } else { 
                list.style.display = 'none'; 
            }
        });

        document.addEventListener('click', function(e) { if (e.target !== input && e.target !== list && e.target !== clearBtn) { list.style.display = 'none'; } });

        function checkGuess() {
            const userGuess = input.value.trim().toLowerCase().replace(/[^a-z0-9]/g, "");
            const correctName = state.games[state.currentGameIndex].name.toLowerCase().replace(/[^a-z0-9]/g, "");
            
            if (userGuess === correctName) {
                // DOƒûRU: Ye≈üil Border
                state.score += state.currentPot; state.history.push({...state.games[state.currentGameIndex], isCorrect: true});
                
                input.classList.remove('focus:ring-2', 'focus:ring-primary'); // Varsayƒ±lanƒ± kaldƒ±r
                input.classList.add('ring-4', 'ring-steam-success', '!ring-opacity-100');
                
                setTimeout(() => { state.currentGameIndex++; loadLevel(); }, 1000);
            } else { 
                // YANLI≈û: Kƒ±rmƒ±zƒ± Border + Shake Animasyonu
                input.classList.remove('focus:ring-2', 'focus:ring-primary');
                input.classList.add('ring-4', 'ring-steam-error', '!ring-opacity-100', 'shake');
                
                // Shake animasyonunu tekrar tetiklemek i√ßin temizle
                setTimeout(() => input.classList.remove('shake'), 500);
            }
        }

        // --- G√úNCELLENEN PAS GE√á FONKSƒ∞YONU ---
        function passGame(btn) {
            if (state.isTransitioning) return;
            state.isTransitioning = true;

            const overlay = document.getElementById('transition-overlay');
            const rect = btn.getBoundingClientRect();
            
            // Overlay'i butonun merkezine konumlandƒ±r
            overlay.style.left = (rect.left + rect.width / 2) + 'px';
            overlay.style.top = (rect.top + rect.height / 2) + 'px';
            
            // Geni≈ület
            overlay.style.width = '300vmax'; // Ekranƒ± garantili kaplamak i√ßin √ßok b√ºy√ºk deƒüer
            overlay.style.height = '300vmax';
            overlay.style.opacity = '1';

            // Animasyon s√ºresi kadar bekle
            setTimeout(() => {
                // Ge√ßmi≈üe ekle
                state.history.push({...state.games[state.currentGameIndex], isCorrect: false});
                state.currentGameIndex++;
                
                // Yeni seviyeyi y√ºkle (kƒ±rmƒ±zƒ± ekranƒ±n arkasƒ±nda)
                loadLevel();

                // Yava≈ü√ßa soldurarak kaybet
                overlay.style.transition = 'opacity 0.4s ease-out';
                overlay.style.opacity = '0';
                
                setTimeout(() => {
                    // Bir sonraki kullanƒ±m i√ßin resetle
                    overlay.style.transition = 'width 0s, height 0s, opacity 0s'; // Resetlerken animasyon olmasƒ±n
                    overlay.style.width = '0';
                    overlay.style.height = '0';
                    state.isTransitioning = false;
                    
                    // Bir sonraki tƒ±klama i√ßin transition'ƒ± geri y√ºkle
                    setTimeout(() => {
                         overlay.style.transition = 'width 0.5s ease-in-out, height 0.5s ease-in-out, opacity 0.3s';
                    }, 50);
                }, 400); // Soldurma s√ºresi kadar bekle
                
            }, 500); // B√ºy√ºme s√ºresi kadar bekle
        }

        document.getElementById('guessInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkGuess(); });

        async function endGame() {
            await fetch(`${API_URL}/submit-score`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username: state.username, category: state.currentCategoryName, score: state.score}) });
            
            state.highScores = saveUserHighScore(state.username, state.currentCategoryName, state.score);

            const res = await fetch(`${API_URL}/leaderboard?category=${encodeURIComponent(state.currentCategoryName)}`);
            const leaderboard = await res.json();
            
            // Oyun bitince 'replace' ile sonu√ß ekranƒ±nƒ± a√ßƒ±yoruz. 
            // B√∂ylece sonu√ß ekranƒ±ndayken geri basƒ±nca bitmi≈ü oyuna d√∂nmez, kategori ekranƒ±na d√∂ner.
            // (√á√ºnk√º oyun ekranƒ± history'de bir √∂nceki adƒ±mda kalƒ±r, result onu ezer)
            showScreen('screen-result', 'replace');
            
            document.getElementById('finalScoreDisplay').innerText = `Mevcut Skor : ${state.score}`;
            document.getElementById('sessionBestDisplay').innerText = `En ƒ∞yi Skor : ${state.highScores[state.currentCategoryName] || state.score}`;
            document.getElementById('resultCategoryTitle').innerText = state.currentCategoryName;
            
            const grid = document.getElementById('resultGrid'); grid.innerHTML = "";
            state.history.forEach(h => {
                const div = document.createElement('div'); div.className = `relative aspect-video bg-black rounded border-2 ${h.isCorrect ? 'border-steam-success' : 'border-steam-error'}`;
                div.innerHTML = `<img src="${h.image}" class="w-full h-full object-cover opacity-70"><div class="absolute bottom-0 w-full bg-black/80 text-white text-[10px] p-1 text-center truncate">${h.name}</div>`;
                grid.appendChild(div);
            });
            const tbody = document.getElementById('leaderboardBody'); tbody.innerHTML = "";
            leaderboard.forEach((p, i) => { const isMe = p.username === state.username ? "bg-primary text-background-dark font-bold" : "text-slate-400 border-b border-white/5"; tbody.innerHTML += `<tr class="${isMe}"><td class="p-3">${i+1}</td><td>${p.username}</td><td>${p.score}</td></tr>`; });
        }
    </script>
    
    <footer class="w-full bg-[#171a21] text-steam-text-dim text-center py-6 border-t border-white/10 mt-auto">
        <div class="max-w-4xl mx-auto px-4 text-xs leading-relaxed">
            <p><strong>GameGuessr</strong>, Valve Corporation tarafƒ±ndan olu≈üturulmamƒ±≈ü, onaylanmamƒ±≈ü veya desteklenmemi≈ütir.</p>
            <p>Bu proje, Steam Web API kullanan, hayran yapƒ±mƒ± (fan-made) √ºcretsiz bir oyundur.</p>
            <p class="mt-2 text-[10px] opacity-40"><a href="/privacy" target="_blank" class="hover:text-primary">Gizlilik Politikasƒ±</a></p>
        </div>
    </footer>
</body>
</html>